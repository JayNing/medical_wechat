<!doctype html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport"
          content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>结果</title>
    <link rel="stylesheet" href="../static/css/style.css">
    <link rel="stylesheet" href="../static/plugins/layui/css/layui.css">
    <link rel="stylesheet" href="../static/plugins/dist/css/weui.css">
</head>
<body style="background-color: #F2FAFC;">

<div class="order-contents" ng-app="questionResultApp" ng-controller="questionResultController"  lay-ignore>

    <!--内容-->

    <div class="layui-row  weui-bg-fff weui-margin-bot" >
        <div class="layui-col-xs12  layui-padd15">
            <div class="layui-col-xs12 layui-font-weight">所选套餐</div>
        </div>
        <div class="layui-col-xs12  layui-padd15 layui-top-solid" ng-repeat="package in packageList1"  lay-ignore>
            <div class="layui-col-xs1 footer-bs-color">-</div>
            <div class="layui-col-xs6 ">{{package.packageName}}</div>
            <div class="layui-col-xs5 login-wjm td-col-red">￥{{package.cost}}元</div>
        </div>
        <div class="layui-col-xs12  layui-padd15 layui-top-solid" ng-repeat="otherIterm in otherPackageUniterms1"  lay-ignore>
            <div class="layui-col-xs1 footer-bs-color">-</div>
            <div class="layui-col-xs6 ">{{otherIterm.unitermName}}</div>
            <div class="layui-col-xs5 login-wjm td-col-red">￥{{otherIterm.cost}}元</div>
        </div>

    </div>

    <div class="layui-row  weui-bg-fff weui-margin-bot">
        <div class="layui-col-xs12  layui-padd15" >
            <div class="layui-col-xs12 layui-font-weight">问卷结果推荐</div>
        </div>
        <div ng-if="uniterms1.length > 0">
            <div class="layui-col-xs12  layui-padd15 layui-top-solid" ng-repeat="iterm in uniterms1"  lay-ignore>
                <div class="layui-col-xs1 footer-bs-color">-</div>
                <div class="layui-col-xs7 ">{{iterm.name}}</div>
                <div class="layui-col-xs2 login-wjm td-col-red">￥{{iterm.price}}元</div>
                <div class="layui-col-xs2 login-wjm">
                    <img src="../static/images/selected_icon.png"  class="layui-wj-xz" ng-click="deleteMoney(iterm.cost)"/>
                    <img src="../static/images/wselected_icon.png"  class="layui-wj-xz  layui-wj-wxz" ng-click="addMoney(iterm.cost)" />
                </div>
            </div>
        </div>
        <div ng-if="uniterms1.length == 0">
            <div class="layui-col-xs1 footer-bs-color">-</div>
            <div class="layui-col-xs7 ">套餐已包含问卷结果推荐检查项</div>
        </div>
    </div>

    <!--<div class="layui-row  weui-bg-fff weui-margin-bot">-->
        <!--<div class="layui-col-xs12  layui-padd15">-->
            <!--<div class="layui-col-xs12 layui-font-weight">私人订制</div>-->
        <!--</div>-->
        <!--<div class="layui-col-xs12    layui-wrap layui-left-hbg">-->
            <!--<ul>-->
                <!--<li class="layui-bg-lan">基础项目（2）</li>-->
                <!--<li>肝胆脾胰肾（0）</li>-->
                <!--<li>心胸肺及腰椎（0）</li>-->
                <!--<li>消化及内脏（1）</li>-->
                <!--<li>消化及内脏（1）</li>-->
            <!--</ul>-->
        <!--</div>-->
        <!--<div class=layui-col-xs12">-->
            <!--<div class="layui-row">-->
                <!--&lt;!&ndash;内容列表&ndash;&gt;-->
                <!--<div class="layui-col-xs12  layui-padd15 bot-solid-2">-->
                    <!--<div class="layui-col-xs1 footer-bs-color">-</div>-->
                    <!--<div class="layui-col-xs7 ">心血管检查</div>-->
                    <!--<div class="layui-col-xs2 login-wjm td-col-red">￥80元</div>-->
                    <!--<div class="layui-col-xs2 login-wjm ">-->
                        <!--<img src="../static/images/selected_icon.png"  class="layui-wj-xz layui-wj-sir"/>-->
                        <!--<img src="../static/images/wselected_icon.png"  class="layui-wj-xz "/>-->
                    <!--</div>-->
                <!--</div>-->
                <!--<div class="layui-col-xs12  layui-padd15  bot-solid-2">-->
                    <!--<div class="layui-col-xs1 footer-bs-color">-</div>-->
                    <!--<div class="layui-col-xs7 ">心室检查</div>-->
                    <!--<div class="layui-col-xs2 login-wjm td-col-red">￥80元</div>-->
                    <!--<div class="layui-col-xs2 login-wjm ">-->
                        <!--<img src="../static/images/selected_icon.png"  class="layui-wj-xz  layui-wj-sir"/>-->
                        <!--<img src="../static/images/wselected_icon.png"  class="layui-wj-xz "/>-->
                    <!--</div>-->
                <!--</div>-->
                <!--&lt;!&ndash;内容列表end&ndash;&gt;-->
            <!--</div>-->
        <!--</div>-->
    <!--</div>-->
    <!--内容end-->
    <!--底部-->
    <div class="layui-row layui-jg-footer weui-bg-fff layui-zxt">
        <div class="layui-col-xs4">共计：<label class="td-col-red">{{totalMoney}}</label></div>
        <div class="layui-col-xs4 " onclick="weikaifang()">
            <a href="javascript:void(0);" class="weui-fcolor4" >
                <i class="layui-icon" style="color:#34C0E3;">&#xe613;</i>
                好友帮选
            </a>
        </div>
        <a href="#">
            <div class="layui-col-xs4 order-bg-2" ng-click="generateOrder()">
                下单
            </div>
        </a>
    </div>
    <!--底部end-->
</div>
<script src="../static/js/jquery.min.js"></script>
<script src="../static/plugins/layui/layui.js"></script>
<script src="../js/validators.js"></script>
<script src="../js/util.js"></script>
<script type="text/javascript" src="../lib/angular/angular.1.5.3.min.js"></script>
<script>

    var url = location.search; //获取url中"?"符后的字串 ('?modFlag=business&role=1')
    var packageId = new Object();
    var answerStr = new Object();
    if ( url.indexOf( "?" ) != -1 ) {
        var str = url.substr( url.indexOf( "?" ) +  1 ); //substr()方法返回从参数值开始到结束的字符串；

        var paramArr = str.split("&");

        var strs = paramArr[0].split( "=" );
        packageId = strs[1];
        answerStr = paramArr[1].split( "=" )[1];

        console.log( packageId ); //此时的packageId；
        console.log( answerStr ); //此时的organizationId就是我们需要的参数；
    }

    $(function () {
        // 私人订制
        $('.layui-left-hbg ul  li').click(function () {
            $(this).addClass('layui-bg-lan').siblings().removeClass('layui-bg-lan');
        });
        // 私人订制end

        // 选择切换
        $('.layui-wj-xz').click(function () {
            $(this).hide();
            $(this).siblings().show();
        });
    });

    function weikaifang() {
        showErrorDialog("此功能正在紧急研发中");
    }

    var app = angular.module('questionResultApp', ['ng']);
    app.controller('questionResultController', function($scope,$http) {
            init(packageId,answerStr);

            $scope.totalMoney = 0;

            $scope.addMoney = function (money) {
//                $scope.totalMoney =  $scope.totalMoney + money;
                showErrorDialog("此功能正在紧急研发中");
            }
            $scope.deleteMoney = function (money) {
//               $scope.totalMoney =  $scope.totalMoney - money;
                showErrorDialog("此功能正在紧急研发中");
            }

            function init(packageId,answerStr) {

                $http({
                    method: "POST",
                    url: '/question/result',
                    data: {
                        'packageId': packageId,
                        'answerStr': answerStr
                    },
                    headers: {'Content-Type': 'application/x-www-form-urlencoded;charset=UTF-8'},
                    transformRequest: function (obj) {
                        var str = [];
                        for (var p in obj) {
                            str.push(encodeURIComponent(p) + "=" + encodeURIComponent(obj[p]));
                        }
                        return str.join("&");
                    }
                }).then(function successCallback(response) {
                    var dataMsg = response.data;
                    if (dataMsg.errorCode == 0) {
                        console.log(dataMsg.data);
                        $scope.packageList1 = dataMsg.data.packageList;
                        var dataUniterms = dataMsg.data.uniterms;

                        if(dataUniterms.length > 0){
                            for(var i=0; i<dataUniterms.length; i++){
                                var price = dataUniterms[i].price;
                                if(price == null || price == '' || price == undefined){
                                    price = 0;
                                }else {
                                    price = (price / 100) + '.' + (price % 100);
                                }
                                dataUniterms[i].price = price;
                            }
                        }
                        $scope.uniterms1 = dataUniterms;

                        $scope.otherPackageUniterms1 = dataMsg.data.otherPackageUniterms;
                        refresh();
                    } else {
                        showErrorDialog(dataMsg.errorMsg);
                    }
                }, function errorCallback(result) {
                    showErrorDialog(result);
                });

            }
            function refresh() {
                layui.use('form', function () {
                    var form = layui.form;
                    form.render();
                    //监听提交
                    form.on('submit(formDemo)', function (data) {
                        layer.msg(JSON.stringify(data.field));
                        return false;
                    });
                });
            }

            $scope.generateOrder = function () {
                window.location.href = "/templates/order.html"
            }

    });
</script>
</body>
</html>