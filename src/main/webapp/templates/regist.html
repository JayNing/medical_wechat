<!doctype html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport"
          content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>注册</title>
    <link rel="stylesheet" href="../static/css/style.css">
    <link rel="stylesheet" href="../static/css/mobileSelect.css">
    <link rel="stylesheet" href="../static/plugins/layui/css/layui.css">
    <link rel="stylesheet" href="../static/plugins/dist/css/weui.min.css">
    <script src="../static/plugins/layui/layui.js"></script>
    <style>
        .layui-form-radio{margin:0px;}
        input::-webkit-input-placeholder { /* WebKit browsers */color: #e5e5e5;}
        input:-moz-placeholder { /* Mozilla Firefox 4 to 18 */color: #e5e5e5;}
        input::-moz-placeholder { /* Mozilla Firefox 19+ */color: #e5e5e5;}
        input:-ms-input-placeholder { /* Internet Explorer 10+ */color: #e5e5e5;}
        .layui-form-select dl dd.layui-this{
            background-color: #34C0E3;
        }
        .layui-login-sf{
          width: 90%;
        }
    </style>
</head>
<body style="background-color: #F2FAFC">

<div class="order-contents">
    <div class="layui-row layui-reg-t-tx weui-margin-bot weui-bg-fff">
        <img src="" id="headImgUrl" class="layui-reg-tx" />
        <!--<span id="nickname" ></span>-->
    </div>
    <!--内容start-->
    <form class="layui-form">
             <div class="layui-padd15 weui-bg-fff weui-margin-bot">
                 <div class="login-sty bot-solid-2">
                     <div class="row">
                         <div class="layui-col-xs2">密码</div>
                         <div class="layui-col-xs10">
                             <input type="password" id="password" maxlength="32" name="password" placeholder="请输最少6位数密码" class="login-input-a"/>
                         </div>
                     </div>
                 </div>
                 <div class="login-sty bot-solid-2">
                     <div class="row">
                         <div class="layui-col-xs2">手机号</div>
                         <div class="layui-col-xs10">
                             <input type="tel" id="phone"  maxlength="11" name="phone" placeholder="请输入新的手机号"  maxlength="11" class="login-input-a layui-login-sf"/>
                         </div>
                     </div>
                 </div>
                 <div class="login-sty  login-r-re">
                     <div class="row">
                         <div class="layui-col-xs2">验证码</div>
                         <div class="layui-col-xs10" lay-ignore>
                             <input type="tel" id="authCode" name="authCode" placeholder="请输入验证码" class="login-input-a login-input-ab" maxlength="6"/>
                             <a href="javascript:sendAuthCode();"  class="login-hqy">获取验证码</a>
                             <!-- a链接点击添加类 layui-click-color-->
                         </div>
                     </div>
                 </div>
             </div>
            <div class="layui-padd11 weui-bg-fff">
                <div class="login-sty bot-solid-2">
                    <div class="row">
                        <div class="layui-col-xs2">姓名</div>
                        <div class="layui-col-xs10">
                            <input type="text" id="username"  maxlength="32" name="username" class="login-input-a"/>
                        </div>
                    </div>
                </div>
                <div class="login-sty bot-solid-2">
                    <div class="row"  >
                        <div class="layui-col-xs2">性别</div>
                        <div class="layui-col-xs10" style="padding-left: 10px" >
                            <input type="radio" name="sex" value="y" title="男"  checked>
                            <input type="radio" name="sex" value="x" title="女" >
                        </div>
                    </div>
                </div>
                <div class="login-sty bot-solid-2">
                    <div class="row">
                        <div class="layui-col-xs2">身份证</div>
                        <div class="layui-col-xs10">
                            <input type="text" id="identityCard"  maxlength="18" name="identityCard" placeholder="请输入正确的身份证号" maxlength="18"  class="login-input-a layui-login-sf"/>
                        </div>
                    </div>
                </div>
                <div class="login-sty ">
                    <div class="row"  id="showDatePicker2">
                        <div class="layui-col-xs3">出生日期</div>
                        <div class="layui-col-xs8 " style="padding-left: 15px">
                            <a href="javascript:;" id="showDatePicker" class="weui-fcolor3" >1980-01-01</a>
                        </div>
                        <div class="layui-col-xs1 login-wjm weui-fcolor3">
                            <i class="layui-icon layui-icon-color">&#xe602;</i>
                        </div>
                        <!--<div class="layui-col-xs8 " style="padding-left: 15px">
                            <a  id="select_2" class="weui-fcolor5  layui-cstime">选择出生日期</a>
                        </div>
                        <div class="layui-col-xs1"><i class="layui-icon" style="float: right;color: #e5e5e5;">&#xe602;</i></div>-->
                    </div>
                </div>
            </div>
            <div class="layui-padd1555 ">
                <div class="layui-row ">
                    <a href="javascript:void(0);" data-status="1" onclick="regist(this)">
                        <div class="layui-col-xs12 layui-reg-btns">
                           注册
                        </div>
                    </a>
                </div>
            </div>
    </form>
    <!--内容end-->
    <!--说明-->
    <div class="layui-row  layui-zxt">
        <div class="layui-col-xs12 ">
            已有账户
            <a href="/login.html" class="weui-fcolor4">立即登录</a>
        </div>
    </div>
    <!--说明end-->


</div>

<script src="../static/js/jquery.min.js"></script>

<script type="text/javascript" src="../static/js/selectDate.js"></script>
<script type="text/javascript" src="../static/layer/layer.js"></script>
<script type="text/javascript" src="../static/js/mobileSelect.js"></script>
<script type="text/javascript" src="../js/validators.js"></script>
<script src="../js/util.js"></script>
<script type="text/javascript" src="../static/js/zepto.min.js"></script>
<script src="https://res.wx.qq.com/open/libs/weuijs/1.0.0/weui.min.js"></script>
<script type="text/javascript">

    $('#showDatePicker2').on('click', function () {
        weui.datePicker({
            start: 1900,
            end: new Date().getFullYear(),
            onChange: function (result) {
                // console.log(result);
            },
            onConfirm: function (result) {
                console.log(result);
                if (result && result.length == 3) {
                    $("#showDatePicker").text(result[0] + "-" + result[1] + "-" + result[2]);
                }
            }
        });
    });


    init();

   function regist(obj) {
       showLoad();
       setTimeout(function(){
           closeLayer();
       },5000);

       if($(obj).attr('data-status') != '1'){
           return false;
       }else{
           $(obj).attr('data-status',2);
       }
       var password = $('#password').val();
       var phone = $('#phone').val();
       var authCode = $('#authCode').val();
       var username = $('#username').val();
       var sex = $('input[name="sex"]:checked').val();
       var identityCard = $('#identityCard').val();
       var birthDay = $('#showDatePicker').text();
       var result = birthDay.split("-");
       var birthDayData = result[0] + "年" + result[1] + "月" + result[2] + "日";

        if(validateInfo(password,phone,authCode,username,sex,identityCard,birthDay)){
            $.ajax({
                url : '/regist/registUser',
                data : {
                    'phone' : phone,
                    'password'  : password,
                    'authCode' : authCode,
                    'username' : username,
                    'identityCard' : identityCard,
                    'sex' : sex,
                    'birthDay'  : birthDayData
                },
                async: false,
                type : 'POST',
                dataType : 'json',
                success : function(dataMsg){
                    console.log(dataMsg);
                    if(dataMsg.errorCode == 0){
                        showSuccessDialog("注册成功");
                        window.location.href = "/templates/home.html";
                    }else{
                        showErrorDialog(dataMsg.errorMsg);
                    }
                },
                error : function(err){
                    console.log(err);
                }
            });
        }
   }

   function sendAuthCode() {
       var phone = $('#phone').val();
       if(phone && phone != ''){
           if(validateMobile(phone)){
               $.ajax({
                   url : '/regist/sendAuthCode',
                   data : {
                       'phone' : phone,
                       'reason'  : 'regist'
                   },
                   async: false,
                   type : 'POST',
                   dataType : 'json',
                   success : function(dataMsg){
                       console.log(dataMsg);
                       if(dataMsg.errorCode == 0){
                           var authCode = dataMsg.data;
                           $('#authCode').val(authCode);
                       }else{
                           showErrorDialog(dataMsg.errorMsg);
                       }
                   },
                   error : function(err){
                       showErrorDialog(err);
                   }
               });
           }else {
               showErrorDialog('手机号格式不正确')
           }
       }else {
           showErrorDialog('手机号不能为空');
       }
   }

   function validateInfo(password,phone,authCode,username,sex,identityCard,birthDay) {
       if(!validateMobile(phone)){
           showErrorDialog("手机号格式不正确")
           return false;
       }
       if(!isCardNo(identityCard)){
           showErrorDialog("身份证输入不合法");
           return false;
       }
       if(authCode == '' || authCode == 'undefine'){
           showErrorDialog("验证码不能为空");
           return false;
       }
       if(password == '' || password == 'undefine'){
           showErrorDialog("密码不能为空");
           return false;
       }
       if(username == '' || username == 'undefine'){
           showErrorDialog("姓名不能为空");
           return false;
       }
       if(birthDay == '' || birthDay == 'undefine'){
           showErrorDialog("出生日期不能为空");
           return false;
       }
       return true;
   }

    /*设置全部参数*/
//    $.selectDate("#select_2",{
//        start:1980,
//        end:2018,
//        select:[1980,1,1],
//        title:'生日选择'
//    },function (data) {
//        console.log(data);
//    });

    // 性别弹窗
    $(function () {
        $('.info-sex').on('click',function () {
            $('.layui-zhezc').show();
            $('.layui-footer-dw').show();
        });
        $('.layui-cancel').on('click',function () {
            $('.layui-zhezc').hide();
            $('.layui-footer-dw').hide();
        });
    });

   // form表单获取
    layui.use('form', function(){
        var form = layui.form;
    });

    function init() {
        $.ajax({
            url : '/loadInfo',
            data : {
            },
            async: false,
            type : 'POST',
            dataType : 'json',
            success : function(dataMsg){
                console.log(dataMsg);
                if(dataMsg.errorCode == 0){
                   var headImgUrl = dataMsg.data.headimgurl;
                   var nickname = dataMsg.data.nickname;
                    $("#headImgUrl").attr('src',headImgUrl);
                    $("#nickname").html(nickname)
                }else{
                    showSuccessDialog(dataMsg.errorMsg);
                }
            },
            error : function(err){
                console.log(err);
            }
        });
    }
</script>
</body>
</html>